
This repository contains both (1) modified code from msABC (Pavlidis et. al., 2010) and (2) custom code from the barn swallow two subspecies ABC analysis.

Regarding the modified msABC code. The (mostly) original version of the ms.c file is also uploaded here, because to our knowledge the download website, http://bio.lmu.de/~pavlidis/msabc, is no longer functional. The modified version is described in our supplementary information. Of note, the "resample" method no longer resamples event times, but resamples population sizes to ensure that populations grow or shrink by at least 2x. This is accomplished by specifying the absolute parameter numbers of the popualtion sizes (not the population size number.) 


References

Pavlidis, P., S. Laurent, and W. Stephan. "msABC: a modification of Hudson’s ms to facilitate multi‐locus ABC analysis." Molecular Ecology Resources 10.4 (2010): 723-727.


Summary of msABC updates:

The following is a description of the changes we made to the msABC program. The updated code is available on GitHub. We initially updated msABC to avoid basic compilation errors on our system, by changing two “return” lines to “return 0”. Next, we updated the program to only calculate and average FST at loci with segregating sites, to avoid “nan”s. Another basic change was closing each missing data file as it is read in, to avoid opening tens of thousands of files at once. To improve performance, we also added code to re-write the missing data files in binary, and then edited the code again to read binary missing data.

Additionally, we added options to msABC to deal with conditional event times in ways not previously included in the program. First, a –C flag was added for specifying an event to occur between a user-specified time and the event time parameter of another, later event. For example, we used this functionality to ensure that, in Model 4, the simulated divergence time is older than 1,000ya, but more recent than the event time parameter drawn for the bottleneck event. Second, a –Z flag was added for specifying an event to occur within a specified range, conditional on it being older than a specific event time parameter. For example, we used this functionality to ensure that the ancient bottleneck occurs between 100kya and 2mya, as long as it is older than the bottleneck event time. Both of these options avoid skewing the bottleneck event time, in our case.

To avoid simulating non-biological demographic scenarios, we used the above flags to ensure that the simulated event times for all models to follow the correct order of events. The msABC program has a functionality that accomplishes this, referred to on the command line as the “resample” method. The resample method re-draws the event time parameters if the specified order or events is incorrect, which effectively skews both (or more) event time distributions. However, we are interested in estimating a particular event time parameter with as much precision and as little bias as possible: divergence time in models 1-3, and bottleneck time in models 4-5. Therefore, we modified msABC to simulate conditional event times in a way that skews only one prior distribution and leaves the other event time prior undisturbed, as in (Rougemont et al., 2016). First, we specified events to be more recent than the event of interest by generating a uniform event time between (a) a user-specified prior minimum and (b) the event of interest. Conversely, we specified events to be older than the event of interest by generating a uniform event time between (a) the event of interest and (b) a user specified prior maximum. The choice of priors always influences the results to some degree, however for this study we chose the described method for conditional event time priors to avoid skewing the parameter of interest, thereby ensuring unbiased parameter estimation. In contrast, the “resample” method in msABC may cause inaccurate parameter estimation because it does not explore each order of magnitude of the important prior (divergence time) equally, or at all in some cases. 

Lastly, we modified msABC to allow a conditional population size prior option. Specifically, we took advantage of the existing code for the “resample” flag, which is for resampling event times until a user-specified condition is met, by instead resampling the specified population sizes until a condition is met. For example, we used this new functionality to resample population sizes to ensure that the bottlenecked population size is at most half the size of the pre-bottlenecked size. 

Additional flags were added for options not used in this analysis. Prior distribution flags –S, –A  and –B were added to (i) simulate the same parameter as another, specific event time, (ii) specifying the desired fold-change in population size when using exponential growth and in combination with the –C flag, (iii) specifying fold-change in population size when exponential growth begins at time zero. Lastly, a “s” option was added to simulate a single, reciprocal migration rate, instead of two different migration rates.
